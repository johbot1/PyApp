<!DOCTYPE html>
<html>
<head>
    <title>D&D Name Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Big ol' title -->
    <h1 id="title">D&D Name Generator</h1>

    <div id="name-display">Generated Name</div>

    <div id="generation-options">
        <div id="first-name-selection">
            <h2>First Name Options:</h2>
            <div id="first-race-selection">
                <h3>Select Race(s):</h3>
                <label><input type="checkbox" name="first-race" value="human"> Human</label><br>
                <label><input type="checkbox" name="first-race" value="elf"> Elf</label><br>
                <label><input type="checkbox" name="first-race" value="dwarf"> Dwarf</label><br>
            </div>
            <div id="first-gender-selection">
                <h3>Select Gender:</h3>
                <label><input type="radio" name="first-gender" value="male"> Male</label><br>
                <label><input type="radio" name="first-gender" value="female"> Female</label><br>
            </div>
        </div>

        <button id="generate-button">Generate Name!</button>

        <div id="last-name-params">
            <h2>Last Name Options:</h2>
            <div id="last-race-selection">
                <h3>Select Race(s):</h3>
                <label><input type="checkbox" name="last-race" value="human"> Human</label><br>
                <label><input type="checkbox" name="last-race" value="elf"> Elf</label><br>
                <label><input type="checkbox" name="last-race" value="dwarf"> Dwarf</label><br>
            </div>
        </div>
    </div>

    <div id="generated-names-container">
    <span id="generated-names-label">Previously Generated Names:</span>
    <div id="generated-names-display"></div>
    </div>



    <script>
        //Array to store generated names (Limited to only the last 15)
        let generatedNames = [];

        // Event listener for the "Generate Name" button
        document.getElementById('generate-button').addEventListener('click', function() {
            // Get selected races for the first name
            const firstRaces = Array.from(document.querySelectorAll('input[name="first-race"]:checked')).map(el => el.value);
            // Get selected gender for the first name
            const firstGender = document.querySelector('input[name="first-gender"]:checked').value;
            // Get selected races for the last name
            const lastRaces = Array.from(document.querySelectorAll('input[name="last-race"]:checked')).map(el => el.value);

            // Ensure a gender is selected before making a request
            if (!firstGender) {
                document.getElementById('name-display').textContent = "Please select a gender.";
                return;
            }

            // Send a POST request to the Flask API
            fetch('/generate_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    firstRaces: firstRaces,
                    firstGender: firstGender,
                    lastRaces: lastRaces
                })
            })
            .then(response => response.json()) // Parse the JSON response
            .then(data => {
                // Check if both first and last names are present in the response
                if (data.firstName && data.lastName) {const fullName = `${data.firstName} ${data.lastName}`;

                // Add new name to the beginning of the array
                generatedNames.unshift(fullName);

                // Keep only the last 15 names
                if (generatedNames.length > 15) {
                    generatedNames.pop();
                }

                // Update the main name display (show the latest name)
                document.getElementById('name-display').textContent = fullName;

                // Update the list of previously generated names
                updateGeneratedNamesDisplay();
            } else {
                document.getElementById('name-display').textContent = data.error || "An error occurred.";
            }
        })
        .catch(error => {
            console.error('Error:', error);
            document.getElementById('name-display').textContent = 'An error occurred.';
        });
    });

    // Function to update the previously generated names display
    function updateGeneratedNamesDisplay() {
        const displayContainer = document.getElementById('generated-names-display');
        displayContainer.innerHTML = ""; // Clear previous list

        generatedNames.forEach(name => {
            const nameElement = document.createElement("div");
            nameElement.textContent = name;
            displayContainer.appendChild(nameElement);
        });
    }
    </script>
</body>
</html>